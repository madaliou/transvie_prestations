{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 15, "column": 0}, "map": {"version":3,"sources":["file:///Users/madaliou/Web/transvie-prestations/frontend/src/app/kpi/page.tsx"],"sourcesContent":["'use client';\n\nimport React, { useState, useEffect } from 'react';\nimport { Table, Typography, Tooltip, Button, Input } from 'antd';\nimport { DownloadOutlined } from '@ant-design/icons';\nimport Papa from 'papaparse';\n\nconst { Title } = Typography;\n\nconst Kpis = () => {\n  const [kpis, setKpis] = useState<any[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [searchText, setSearchText] = useState('');\n\n  useEffect(() => {\n    const fetchKpis = async () => {\n      try {\n        const res = await fetch('http://localhost:3001/api/kpis');\n        const data = await res.json();\n        setKpis(data);\n      } catch (err) {\n        console.error('Erreur de chargement des KPIs', err);\n      } finally {\n        setLoading(false);\n      }\n    };\n\n    fetchKpis();\n  }, []);\n\n  const formatDateTime = (dateStr: string) => {\n    const date = new Date(dateStr);\n    return date.toLocaleString('fr-FR', {\n      weekday: 'short',\n      year: 'numeric',\n      month: 'long',\n      day: 'numeric',\n      hour: '2-digit',\n      minute: '2-digit',\n    });\n  };\n\n  const handleExportCSV = () => {\n    const csvData = filteredData.map(kpi => ({\n      Agence: kpi.agence,\n      Prestation: kpi.prestation,\n      Date: formatDateTime(kpi.date),\n      Nombre: kpi.count,\n    }));\n\n    const csv = Papa.unparse(csvData);\n    const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });\n    const link = document.createElement('a');\n    link.href = URL.createObjectURL(blob);\n    link.setAttribute('download', 'kpis.csv');\n    document.body.appendChild(link);\n    link.click();\n    document.body.removeChild(link);\n  };\n\n  const filteredData = kpis.filter((item) =>\n    Object.values(item)\n      .join(' ')\n      .toLowerCase()\n      .includes(searchText.toLowerCase())\n  );\n\n  const columns = [\n    {\n      title: 'Agence',\n      dataIndex: 'agence',\n      key: 'agence',\n      sorter: (a: any, b: any) => a.agence.localeCompare(b.agence),\n    },\n    {\n      title: 'Prestation',\n      dataIndex: 'prestation',\n      key: 'prestation',\n      render: (text: string) =>\n        text.length > 40 ? (\n          <Tooltip title={text}>\n            {text.slice(0, 20)}...{text.slice(-15)}\n          </Tooltip>\n        ) : (\n          text\n        ),\n    },\n    {\n      title: 'Date',\n      dataIndex: 'date',\n      key: 'date',\n      render: (date: string) => formatDateTime(date),\n      sorter: (a: any, b: any) =>\n        new Date(a.date).getTime() - new Date(b.date).getTime(),\n    },\n    {\n      title: 'Nombre',\n      dataIndex: 'count',\n      key: 'count',\n      sorter: (a: any, b: any) => a.count - b.count,\n      align: 'right' as const,\n    },\n  ];\n\n  return (\n    <div style={styles.container}>\n      <Title level={2} style={styles.title}>Statistiques des Prestations</Title>\n\n      <div style={styles.actions}>\n        <Input\n          placeholder=\"ðŸ” Rechercher...\"\n          value={searchText}\n          onChange={(e) => setSearchText(e.target.value)}\n          style={styles.searchInput}\n        />\n        <Button\n          type=\"primary\"\n          icon={<DownloadOutlined />}\n          onClick={handleExportCSV}\n        >\n          Exporter en CSV\n        </Button>\n      </div>\n\n      <Table\n        columns={columns}\n        dataSource={filteredData.map((item, index) => ({ ...item, key: index }))}\n        loading={loading}\n        pagination={{ pageSize: 10 }}\n        bordered\n        size=\"middle\"\n      />\n    </div>\n  );\n};\n\nconst styles: { [key: string]: React.CSSProperties } = {\n  container: {\n    margin: '40px auto',\n    padding: '30px',\n    maxWidth: '1100px',\n    backgroundColor: '#fff',\n    borderRadius: '10px',\n    boxShadow: '0 3px 15px rgba(0,0,0,0.05)',\n    fontFamily: 'Segoe UI, sans-serif',\n  },\n  title: {\n    textAlign: 'center',\n    color: '#007bff',\n    marginBottom: '30px',\n  },\n  actions: {\n    display: 'flex',\n    justifyContent: 'space-between',\n    marginBottom: '20px',\n  },\n  searchInput: {\n    width: 300,\n    borderRadius: 6,\n  },\n};\n\nexport default Kpis;\n"],"names":[],"mappings":"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","debugId":null}}]
}